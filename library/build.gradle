apply plugin: 'com.android.library'

//def versionName() {
//    String config = 'library/src/main/java/com/qiniu/android/common/Config.java'
//    String fileContents = new File(config).text
//    Matcher myMatcher = fileContents =~ /VERSION = "(.+)";/
//    String version = myMatcher[0][1]
//    println(version)
//    return version
//}

def versionNameToCode(String version) {
    String v = version.replaceAll(/\./, '')
    return v.toLong()
}

int code = versionNameToCode(QINIU_LIB_VERSION)

android {
    compileSdkVersion 21
    buildToolsVersion '21.0.1'
    defaultConfig {
        minSdkVersion 14
        targetSdkVersion 21
        versionCode code
        versionName version
    }
}

dependencies {
    compile fileTree(include: ['*.jar'], dir: 'libs')
    compile 'com.loopj.android:android-async-http:1.4.6'
}

task releaseJar(type: Copy, dependsOn: 'build') {
    from('build/intermediates/bundles/release')
    into('../releases')
    include('classes.jar')
    rename('classes.jar', 'qiniu-android-sdk-' + version + '.jar')
}

setProperty('VERSION_NAME', version)
setProperty('VERSION_CODE', code)

apply from: 'https://raw.github.com/chrisbanes/gradle-mvn-push/master/gradle-mvn-push.gradle'
